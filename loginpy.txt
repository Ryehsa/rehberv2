import dbLogin
from dbLogin import Login
from sqlalchemy import create_engine, select
from sqlalchemy.orm import sessionmaker, Query


kayitli = False
# db bağlantı
engine = create_engine("sqlite:///login.db", echo=True)
Session = sessionmaker(bind=engine)
session = Session()


def kullanicivarmi(kullanici_Adi):
    kullanici = session.query(Login).filter_by(kullanici_Adi=kullanici_Adi).first()
    session.close()
    return kullanici


def girisKontrol(kullanici_adi, sifre):
    query = select([dbLogin.Login]).where(
        Login.kullanici_Adi == kullanici_adi, Login.sifre == sifre
    )
    result = engine.execute(query)
    session.commit()
    if result.fetchone() is None:
        print("hatalı giriş")
    elif result.fetchone() is not None:
        print("giriş başarılı")


def kullaniciKayit(kullanici_adi, sifre):
    # kullanıcı varmı kontrol
    kullanici = kullanicivarmi(kullanici_adi)
    # kullanıcı yoksa
    if kullanici == False:
        kisiEkle = dbLogin.Login(kullanici_adi=kullanici_adi, sifre=sifre)
        session.add(kisiEkle)
        session.commit()
        print("başarıyla eklendi")
    # kullanıcı varsa
    elif kullanici == True:
        print("kullanici kayıtlı lütfen giris yapiniz")
